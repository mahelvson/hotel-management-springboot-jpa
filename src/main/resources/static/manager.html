<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Gerenciamento de Recepcionistas</title>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar {
            background-color: #343a40 !important;
        }
        .main-content {
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        .highlight {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Reserva de Hotel</a>
            <div id="userDetails" class="ms-auto text-white">
                <span id="username" class="me-3"></span>
                <button id="logoutButton" class="btn btn-outline-light btn-sm">Sair</button>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <h2 class="text-center">Gerenciamento de Recepcionistas</h2>

        
        <div class="mb-4">
            <h4>Recepcionistas Cadastrados</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="receptionistTableBody">
                    
                </tbody>
            </table>
        </div>

        
        <div class="highlight">
            <h4>Criar Novo Recepcionista</h4>
            <form id="createReceptionistForm">
                <div class="mb-3">
                    <label for="newName" class="form-label">Nome</label>
                    <input type="text" id="newName" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="newEmail" class="form-label">Email</label>
                    <input type="email" id="newEmail" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="newPassword" class="form-label">Senha</label>
                    <input type="password" id="newPassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Cadastrar Recepcionista</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchCurrentUser();
            fetchReceptionists();

            document.getElementById("createReceptionistForm").addEventListener("submit", async (event) => {
                event.preventDefault();
                createReceptionist();
            });
        });

        async function fetchCurrentUser() {
            try {
                const response = await fetch("http://localhost:8080/auth/currentUser");
                if (response.ok) {
                    const userData = await response.json();
                    localStorage.setItem("user", JSON.stringify(userData));
                    localStorage.setItem("isLoggedIn", true);
                    displayUserInfo(userData);
                } else {
                    console.log("Não foi possível obter os dados do usuário.");
                    localStorage.removeItem("isLoggedIn");
                }
            } catch (error) {
                console.error("Erro ao obter dados do usuário:", error);
                localStorage.removeItem("isLoggedIn");
            }
        }

        function displayUserInfo(user) {
            const userDetails = document.getElementById("userDetails");
            userDetails.innerHTML = `
                <span>
                    Bem-vindo, ${user.name}
                </span>
                <button id="logoutButton" class="btn btn-light ms-2">Sair</button>
            `;

            document.getElementById("logoutButton").addEventListener("click", () => {
                localStorage.removeItem("user");
                window.location.href = "/logout";
            });
        }

        async function fetchReceptionists() {
            try {
                const response = await fetch("http://localhost:8080/receptionists");
                if (response.ok) {
                    const receptionists = await response.json();
                    displayReceptionists(receptionists);
                } else {
                    console.error("Erro ao buscar recepcionistas");
                }
            } catch (error) {
                console.error("Erro ao buscar recepcionistas:", error);
            }
        }

        function displayReceptionists(receptionists) {
            const tableBody = document.getElementById("receptionistTableBody");
            tableBody.innerHTML = "";

            receptionists.forEach(receptionist => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${receptionist.id}</td>
                    <td>${receptionist.name}</td>
                    <td>${receptionist.email}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="updateReceptionist(${receptionist.id})">Alterar</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteReceptionist('${receptionist.email}')">Remover</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function createReceptionist() {
            const name = document.getElementById("newName").value.trim();
            const email = document.getElementById("newEmail").value.trim();
            const password = document.getElementById("newPassword").value.trim();

            try {
                const response = await fetch(`http://localhost:8080/receptionists?name=${name}&email=${email}&password=${password}`, {
                    method: "POST",
                });

                if (response.ok) {
                    alert("Recepcionista cadastrado com sucesso!");
                    fetchReceptionists();
                    document.getElementById("createReceptionistForm").reset();
                } else {
                    alert("Erro ao cadastrar recepcionista.");
                }
            } catch (error) {
                console.error("Erro ao criar recepcionista:", error);
                alert("Erro ao criar recepcionista.");
            }
        }

        async function deleteReceptionist(email) {
            if (!confirm("Deseja realmente remover este recepcionista?")) return;

            try {
                const response = await fetch(`http://localhost:8080/receptionists/deleteByEmail?email=${email}`, {
                    method: "DELETE",
                });

                if (response.ok) {
                    alert("Recepcionista removido com sucesso!");
                    fetchReceptionists();
                } else {
                    alert("Erro ao remover recepcionista.");
                }
            } catch (error) {
                console.error("Erro ao remover recepcionista:", error);
                alert("Erro ao remover recepcionista.");
            }
        }

        async function updateReceptionist(id) {
            const name = prompt("Digite o novo nome do recepcionista:");
            const email = prompt("Digite o novo email do recepcionista:");
            const password = prompt("Digite a nova senha do recepcionista:");

            if (!name || !email || !password) {
                alert("Todos os campos devem ser preenchidos para a atualização.");
                return;
            }

            try {
                const response = await fetch(`http://localhost:8080/receptionists/update/${id}?name=${name}&email=${email}&password=${password}`, {
                    method: "PATCH",
                });

                if (response.ok) {
                    alert("Recepcionista atualizado com sucesso!");
                    fetchReceptionists();
                } else {
                    alert("Erro ao atualizar recepcionista.");
                }
            } catch (error) {
                console.error("Erro ao atualizar recepcionista:", error);
                alert("Erro ao atualizar recepcionista.");
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMF6Qa0fP6WU8L8fQ7UJ4F2JpGnJ4N6F7+VOMeNE5B/n/tlgbF42MO4IvJ" crossorigin="anonymous"></script>
</body>
</html>
