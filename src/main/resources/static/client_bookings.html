<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        background-color: #f8f9fa; /* Background padrão do Bootstrap (cinza claro) */
      }
      .navbar {
        background-color: #343a40 !important; /* Cinza escuro padrão do Bootstrap */
      }
      .login-container {
        display: flex;
        align-items: center;
        justify-content: flex-end;
      }
      .main-content {
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .reservation-card {
        margin-bottom: 20px;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        background-color: #f8f9fa;
      }
    </style>
    <title>Minhas Reservas</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Reserva de Hotel</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div id="userDetails" class="ms-auto">
            <span id="username" class="text-white me-2"></span>
            <button id="logoutButton" class="btn btn-outline-light">Sair</button>
          </div>
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      <h2>Minhas Reservas</h2>
      <div id="reservationsContainer" class="mt-4">
        
      </div>
    </div>

    <script>
      
      function displayUserInfo(user) {
        document.getElementById("username").textContent = user.name;
        document
          .getElementById("logoutButton")
          .addEventListener("click", () => {
            localStorage.removeItem("user");
            window.location.href = "/logout";
          });
      }

      
      async function fetchUserReservations() {
        try {
          const user = JSON.parse(localStorage.getItem("user"));
          if (!user) {
            alert("Usuário não autenticado. Por favor, faça login.");
            window.location.href = "/login";
            return;
          }

          displayUserInfo(user);

          const response = await fetch(`/bookings/user/${user.id}`);
          if (response.ok) {
            const reservations = await response.json();
            displayReservations(reservations);
          } else {
            console.error("Erro ao buscar reservas.");
          }
        } catch (error) {
          console.error("Erro ao buscar reservas do usuário:", error);
        }
      }

      
      function displayReservations(reservations) {
        const container = document.getElementById("reservationsContainer");
        container.innerHTML = "";

        if (reservations.length === 0) {
          container.innerHTML = "<p>Você não possui reservas ativas.</p>";
          return;
        }
        console.log("Reservations: ", reservations);
        reservations.forEach((reservation) => {
          console.log("Reservation: ", reservation);
          const card = document.createElement("div");
          card.classList.add("reservation-card");

          card.innerHTML = `
            <h5>Hotel: ${reservation.room.hotel.name}</h5>
            <p><strong>Quarto Número:</strong> ${reservation.room.roomNumber}</p>
            <p><strong>Check-In:</strong> ${reservation.dateCheckIn}</p>
            <p><strong>Check-Out:</strong> ${reservation.dateCheckOut}</p>
            <p><strong>Total Pago:</strong> R$${reservation.total}</p>
            <p><strong>Status:</strong> ${reservation.bookingStatus}</p>
          `;

          container.appendChild(card);
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        const user = JSON.parse(localStorage.getItem("user"));
        if (user) {
          displayUserInfo(user);
          fetchUserReservations();
        } else {
          window.location.href = "/login"; 
        }
      });
    </script>
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
    crossorigin="anonymous"
  />
  </body>
</html>
